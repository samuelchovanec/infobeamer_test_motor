#!/usr/bin/python2.7
from time import sleep
from hosted import device

DIR = 20
STEP = 21
CW = 1
CCW = 0
SPR = 1

# Set up the direction and step pins
device.gpio.setup_pin(DIR, "out")
device.gpio.setup_pin(STEP, "out")
device.gpio.set_pin_value(DIR, CW)

MODE = (14, 15, 18)
# Set up the resolution mode pins
for pin in MODE:
    device.gpio.setup_pin(pin, "out")

RESOLUTION = {'Full': (0, 0, 0),
              'Half': (1, 0, 0),
              '1/4': (0, 1, 0),
              '1/8': (1, 1, 0),
              '1/16': (0, 0, 1),
              '1/32': (1, 0, 1)}

# Set the resolution mode
for pin, value in zip(MODE, RESOLUTION['Full']):
    device.gpio.set_pin_value(pin, value)

step_count = SPR 
delay = .005
delay_divided = delay
step_count_multiplied = step_count

for i in range(100):
    delay = delay_divided
    for x in range(step_count_multiplied):
        device.gpio.set_pin_value(STEP, 1)
        sleep(delay)
        device.gpio.set_pin_value(STEP, 0)
        sleep(delay)
    step_count_multiplied += 1
    if delay_divided > 0.001:
        delay_divided = delay_divided / 1.05
    print(step_count_multiplied, delay_divided)
